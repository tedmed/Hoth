@page "/alerts"
@using CAP.DTOs;
@inject CAPApiClient CapApi

<PageTitle>Alerts</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Current Alerts</MudText>

@if (AlertInfoDTOs == null)
{
    <MudProgressCircular Color="Color.Default" Indeterminate="true" />
}
else
{
<MudStack>
    <MudPaper Class="p-4 mt-2">
        <MudText Typo="Typo.subtitle2">Filter by Area:</MudText>
        <MudSelect @bind-Value="selectedRegion" Clearable="true">
            @foreach (var c in AvailableRegions)
            {
                <MudSelectItem Value="@c">@c</MudSelectItem>
            }
        </MudSelect>
    </MudPaper>


    <MudSpacer />
    <MudDataGrid Items="FilteredAlertInfoDTOs" FilterCaseSensitivity="DataGridFilterCaseSensitivity.CaseInsensitive" FilterMode="DataGridFilterMode.ColumnFilterMenu">
        <Columns>
            <PropertyColumn Property="x => x.Event"></PropertyColumn>
            <PropertyColumn Property="x => x.Severity" Sortable="true" Filterable="true"></PropertyColumn>
            <PropertyColumn Property="x => x.Certainty" Sortable="true" Filterable="true"></PropertyColumn>
            <PropertyColumn Property="x => x.Urgency" Sortable="true" Filterable="true"></PropertyColumn>
            <PropertyColumn Property="x => x.Description" Sortable="true" Filterable="true"></PropertyColumn>
            <PropertyColumn Property="x => x.Instruction" Sortable="true" Filterable="true"></PropertyColumn>
            <PropertyColumn Property="x => x.AreaDesc" Sortable="true" Filterable="true" Title="Area">
            </PropertyColumn>
            <PropertyColumn Property="x => x.Onset"></PropertyColumn>
            <PropertyColumn Property="x => x.Expires"></PropertyColumn>

        </Columns>

    </MudDataGrid>
</MudStack>
    }


@code {
    private AlertInfoDTO[]? AlertInfoDTOs;
    private AlertInfoDTO[]? FilteredAlertInfoDTOs => string.IsNullOrEmpty(selectedRegion)
        ? AlertInfoDTOs
        : AlertInfoDTOs?.Where(a => a.AreaDesc != null && a.AreaDesc.Contains(selectedRegion)).ToArray();
    private string[] AvailableRegions;
    private string selectedRegion;

    protected override async Task OnInitializedAsync()
    {
        AlertInfoDTOs = await CapApi.GetAlertsAsync(); // Replace with actual API call
        AvailableRegions = await CapApi.GetAvailableRegionsAsync();
    }
}
